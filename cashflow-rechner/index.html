```html
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Cashflow-Rechner | Mehrfamilienhaus & Eigentumswohnung</title>
  <meta name="description" content="Cashflow-Rechner für Eigentumswohnungen & Mehrfamilienhäuser. Kredit, Rate, Nebenkosten und monatlicher Cashflow realistisch berechnen." />
  <link rel="canonical" href="https://grundmannconsulting.de/cashflow-rechner/" />

  <meta property="og:title" content="Cashflow-Rechner | Grundmann Consulting" />
  <meta property="og:description" content="Kredit, Rate, Nebenkosten und monatlicher Cashflow realistisch berechnen." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://grundmannconsulting.de/cashflow-rechner/" />
  <meta property="og:image" content="https://grundmannconsulting.de/assets/Wohngebäude.png" />
  <meta name="robots" content="index,follow" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #f3efe7;
      --text: #111;
      --muted: rgba(0,0,0,.72);
      --max: 1160px;
      --radius: 12px;
      --base: 16px;
      --heroGrad: linear-gradient(90deg, rgba(16,40,33,.92) 0%, rgba(16,40,33,.75) 58%, rgba(16,40,33,.15) 100%);
      --panel: rgba(255,255,255,.22);
      --sectionGap: 32px;
    }

    *{ box-sizing:border-box; }
    html{ scroll-behavior:smooth; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      font-size: var(--base);
      line-height: 1.65;
    }
    p, li, label, input, button, a, small, textarea { font-size: var(--base); }
    .container{ width: min(var(--max), 92vw); margin: 0 auto; }

    .topnav{
      position: sticky;
      top: 0;
      z-index: 50;
      background: var(--heroGrad);
      color:#fff;
      border-bottom: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .topnav .container{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 0;
      gap: 18px;
      min-width:0;
    }
    .logo{ display:flex; align-items:center; text-decoration:none; color:#fff; font-weight:700; }
    .logo-img{ height: 50px; width:auto; display:block; }

    .navlinks{
      display:flex;
      align-items:center;
      gap: 10px;
      flex: 1;
      justify-content: flex-end;
      min-width:0;
      overflow-x:auto;
      overflow-y:hidden;
      white-space:nowrap;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      padding: 0 4px;
    }
    .navlinks::-webkit-scrollbar{ display:none; }
    .navlinks a{
      color:#fff; text-decoration:none; font-weight:600;
      padding: 8px 8px; border-radius: 10px;
      flex: 0 0 auto;
    }
    .navlinks a:hover{ background: rgba(255,255,255,.10); }

    .frame-gap{ padding: var(--sectionGap) 0; }

    .pagehead{
      width: min(var(--max), 92vw);
      margin: 54px auto 0;
      border-radius: var(--radius);
      overflow: hidden;
      background: var(--panel);
      border: 1px solid rgba(0,0,0,.10);
      padding: 26px 22px;
    }
    .pagehead h1{ margin: 0 0 6px; font-size: 28px; line-height: 1.15; }
    .pagehead p{ margin: 0; color: var(--muted); max-width: 90ch; }

    .grid{
      display:grid;
      grid-template-columns: .95fr 1.05fr;
      gap: 26px;
      align-items: stretch;
    }

    .panel{
      background: var(--panel);
      border: 1px solid rgba(0,0,0,.10);
      border-radius: var(--radius);
      padding: 18px;
    }
    .panel h2{ font-size: 18px; margin: 0 0 14px; letter-spacing: .2px; }
    .subhead{ margin: 18px 0 10px; font-weight: 700; font-size: 14px; opacity: .9; }

    .rows{ display:flex; flex-direction:column; gap: 12px; }
    .row{
      display:grid;
      grid-template-columns: 1fr 220px;
      gap: 14px;
      align-items:center;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(0,0,0,.10);
    }
    .row:last-child{ border-bottom:none; padding-bottom:0; }

    .label{ font-weight: 700; }
    .hint{ color: var(--muted); font-size: 12px; margin-top: 2px; }

    input{
      width:100%;
      border: none;
      background: rgba(0,0,0,.08);
      padding: 10px 12px;
      font-family: inherit;
      outline:none;
      border-radius: 8px;
      text-align: right;
    }

    input.auto-muted{
      background: rgba(0,0,0,.04);
      color: rgba(0,0,0,.62);
    }
    input.auto-muted::selection{ background: rgba(0,0,0,.12); }

    .suffix{ position: relative; }
    .suffix span{
      position:absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: rgba(0,0,0,.55);
      font-weight: 600;
      pointer-events:none;
    }
    .suffix input{ padding-right: 34px; }

    .ek-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      align-items:start;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(0,0,0,.10);
    }
    .ek-grid .ekbox{
      display:flex;
      flex-direction:column;
      gap: 6px;
    }

    .chip-row{ display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 0; }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      background: rgba(0,0,0,.06);
      border: 1px solid rgba(0,0,0,.12);
      cursor:pointer;
      user-select:none;
      font-weight:600;
      color:#111;
    }
    .chip input{ width:auto; margin:0; }
    .chip small{ font-size:12px; color: rgba(0,0,0,.62); font-weight:600; }

    aside.panel[aria-label="Ergebnisse"]{
      display:flex;
      flex-direction:column;
      height: 100%;
      min-height: 0;
    }
    .result{
      display:flex;
      flex-direction:column;
      gap: 12px;
      overflow:auto;
      min-height: 0;
      padding-right: 4px;
    }

    .kpi{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      padding: 12px 12px;
      border-radius: 10px;
      background: rgba(255,255,255,.28);
      border: 1px solid rgba(0,0,0,.10);
      gap: 10px;
    }
    .kpi .name{ font-weight: 700; }
    .kpi .val{ font-weight: 700; text-align:right; }
    .kpi.green{ background: rgba(34,139,34,.10); border-color: rgba(34,139,34,.22); }
    .kpi.red{ background: rgba(200,0,0,.08); border-color: rgba(200,0,0,.18); }

    .kpi-divider{
      height: 1px;
      background: rgba(0,0,0,.10);
      margin: 10px 0;
    }

    .small{ color: var(--muted); font-size: 12px; margin: 6px 0 0; }

    .btnrow{ display:flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; }

    .btnrow.controls{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-items:start;
    }
    .btncol{ display:flex; flex-direction:column; gap:10px; }
    .btncol.right{ align-items:stretch; }

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      background: var(--heroGrad);
      color:#fff; border:none;
      padding: 10px 14px;
      font-weight:700; cursor:pointer; text-decoration:none;
      transition: transform .12s ease, filter .12s ease;
      border-radius: 10px;
      width: 100%;
    }
    .btn:hover{ filter: brightness(1.05); transform: translateY(-1px); }
    .btn.ghost{ background: rgba(0,0,0,.08); color:#111; border: 1px solid rgba(0,0,0,.14); }

    .section-title{
      text-align:center;
      font-weight: 700;
      font-size: 32px;
      margin: 0 0 18px;
    }

    .pricing-panel{
      background: transparent;
      border: none;
      border-radius: 0;
      padding: 0;
    }
    .pricing-panel h2{
      text-align:center;
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 18px;
      letter-spacing: .2px;
    }
    .price-table{
      width:100%;
      margin: 0 auto;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      border: 1px solid rgba(0,0,0,.12);
      border-radius: 10px;
      overflow:hidden;
      background: transparent;
    }
    .price-col{
      padding: 16px 14px 14px;
      border-right: 1px solid rgba(0,0,0,.10);
      min-height: 560px;
      display:flex;
      flex-direction:column;
    }
    .price-col:last-child{ border-right:none; }

    .kicker{
      font-weight: 700;
      font-size: 18px;
      opacity:.95;
      margin-bottom: 6px;
      height: 44px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 0 6px;
      color: #102821;
    }
    .price{
      font-weight: 700;
      font-size: 26px;
      margin: 0;
      min-height: 34px;
      text-align: center;
    }
    .sub{
      opacity:.85;
      font-size: 12px;
      margin-top: 2px;
      min-height: 22px;
      text-align: center;
    }
    .col-cta{
      height: 48px;
      display:flex;
      align-items:center;
      justify-content:center;
      margin: 10px 0 10px;
    }
    .col-cta .btn{ width:100%; }
    .col-desc{
      color: rgba(0,0,0,.76);
      margin: 6px 0 10px;
      line-height: 1.6;
    }
    .checks{
      list-style:none;
      padding:0;
      margin: 0;
      display:flex;
      flex-direction:column;
      gap: 8px;
      color: rgba(0,0,0,.78);
    }
    .checks li{
      display:flex;
      gap: 8px;
      align-items:flex-start;
    }
    .dot{
      width:14px;height:14px;
      border-radius:50%;
      background: rgba(0,0,0,.10);
      position:relative;
      margin-top: 3px;
      flex: 0 0 14px;
    }
    .dot:after{
      content:"";
      position:absolute;
      left:4px; top:3px;
      width:6px; height:3px;
      border-left:2px solid rgba(0,0,0,.60);
      border-bottom:2px solid rgba(0,0,0,.60);
      transform: rotate(-45deg);
    }

    .forecast-panel{
      background: var(--panel);
      border: 1px solid rgba(0,0,0,.10);
      border-radius: var(--radius);
      padding: 28px;
    }
    .forecast-panel h2{
      text-align:center;
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 18px;
      letter-spacing: .2px;
    }
    .chart-wrap{
      background: rgba(255,255,255,.18);
      border: 1px solid rgba(0,0,0,.10);
      border-radius: 12px;
      padding: 12px;
      overflow:hidden;
      margin-top: 12px;
    }
    .chart-title{
      font-weight: 700;
      margin: 0 0 8px;
    }
    canvas{
      width: 100% !important;
      height: 320px !important;
      display:block;
    }
    .chart-note{
      color: var(--muted);
      font-size: 12px;
      margin-top: 10px;
      line-height: 1.5;
    }

    .taxbox{
      margin-top: 10px;
      border-radius: 12px;
      background: rgba(255,255,255,.22);
      border: 1px solid rgba(0,0,0,.10);
      padding: 12px;
    }
    .taxbox h3{
      margin: 0 0 10px;
      font-size: 14px;
      letter-spacing: .2px;
    }
    .taxgrid{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 6px 12px;
      align-items:baseline;
      font-size: 13px;
    }
    .taxgrid .k{ color: rgba(0,0,0,.78); }
    .taxgrid .v{ font-weight: 700; text-align:right; }
    .taxline{ height:1px; background: rgba(0,0,0,.10); margin: 10px 0; }
    .taxhint{ color: var(--muted); font-size: 12px; margin-top: 10px; line-height:1.5; }

    .desc-wrap{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px 18px;
    }
    .desc-block h3{
      margin: 0 0 8px;
      font-size: 14px;
      letter-spacing: .2px;
    }
    .desc-block ul{
      margin: 0;
      padding-left: 18px;
      color: rgba(0,0,0,.82);
      line-height: 1.55;
    }
    .desc-block li{ margin: 6px 0; }
    .desc-block code{
      background: rgba(0,0,0,.06);
      padding: 2px 6px;
      border-radius: 6px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
    }

    .contact-direct{
      display:flex;
      gap:36px;
      align-items:center;
      margin:12px 0 18px;
      font-weight:600;
      flex-wrap:wrap;
    }
    .contact-item{ display:flex; align-items:center; gap:8px; }
    .contact-item a{ text-decoration:none; color:var(--text); }
    .contact-item a:hover{ text-decoration:underline; }
    .icon svg{ display:block; color:#000; }
    .field{ margin-bottom:14px; }
    textarea{
      width:100%;
      border:none;
      background:rgba(0,0,0,.08);
      padding:12px;
      outline:none;
      border-radius: 8px;
      font-family: inherit;
      min-height:160px;
      resize:vertical;
    }

    footer{
      margin-top:54px;
      padding:22px 0 56px;
      border-top:1px solid rgba(0,0,0,.25);
      text-align:center;
    }
    .footer-logo{ height:44px; width:auto; opacity:.85; display:block; margin:0 auto 6px; }
    footer a{ font-size:12px; text-decoration:none; color:#111; }

    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .row{ grid-template-columns: 1fr; }
      input{ text-align:left; }
      .logo-img{ height: 40px; }
      .ek-grid{ grid-template-columns: 1fr; }
      .btnrow.controls{ grid-template-columns: 1fr; }

      canvas{ height: 300px !important; }
      .desc-wrap{ grid-template-columns: 1fr; }

      .price-table{ grid-template-columns: 1fr; }
      .price-col{
        min-height:auto;
        border-right:none;
        border-bottom: 1px solid rgba(0,0,0,.10);
      }
      .price-col:last-child{ border-bottom:none; }

      aside.panel[aria-label="Ergebnisse"]{ height:auto; }
      .result{ overflow: visible; }
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>

<body>

  <nav class="topnav">
    <div class="container">
      <a class="logo" href="/" aria-label="Startseite">
        <img src="/assets/Logo_Grundmann-Consulting_white.png" alt="Grundmann Consulting Logo" class="logo-img">
      </a>
      <div class="navlinks">
        <a href="/">Home</a>
        <a href="https://grundmannconsulting.de/immobilienberatung-halle/">Halle</a>
        <a href="https://grundmannconsulting.de/immobilienberatung-leipzig/">Leipzig</a>
        <a href="https://grundmannconsulting.de/immobilienberatung-dresden/">Dresden</a>
        <a href="https://grundmannconsulting.de/ki/">KI</a>
        <a href="https://grundmannconsulting.de/hausverwaltung/">Hausverwaltung</a>
        <a href="https://grundmannconsulting.de/bundesanleihe/">Bundesanleihe</a>
        <a href="#preise">Beratungsleistungen</a>
        <a href="#kontakt">Kontakt</a>
      </div>
    </div>
  </nav>

  <header class="pagehead">
    <h1>Cashflow-Rechner</h1>
    <p>Erstcheck für Kauf &amp; Bestand: Kreditsumme, Rate, nicht umlagefähige Kosten und Cashflow (optional inkl. Steuerwirkung).</p>
  </header>

  <main class="frame-gap">
    <div class="container">
      <div class="grid">

        <section class="panel" aria-label="Eingaben">
          <div class="rows">

            <div class="row">
              <div>
                <div class="label">Kaufpreis</div>
                <div class="hint">Kaufpreis ohne Nebenkosten/Capex. Basis für EK, Kredit und Kennzahlen.</div>
              </div>
              <div class="suffix">
                <input id="kaufpreis" type="text" inputmode="numeric" value="0" autocomplete="off">
                <span>€</span>
              </div>
            </div>

            <div class="subhead">Steuer / AfA (Liquidität nach Steuer)</div>

            <div class="ek-grid">
              <div class="ekbox">
                <div class="label">Baujahr</div>
                <div class="hint">AfA: vor 1925 = 2,5%, ab 1925 = 2,0% (vereinfachtes Modell).</div>
                <div class="suffix">
                  <input id="baujahr" type="text" inputmode="numeric" value="1900" autocomplete="off">
                  <span>J</span>
                </div>
              </div>

              <div class="ekbox">
                <div class="label">Gebäudeanteil (%)</div>
                <div class="hint">Anteil der Anschaffungskosten (KP+NK), der als Gebäude (AfA) angesetzt wird.</div>
                <div class="suffix">
                  <input id="geb_anteil_pct" type="text" inputmode="decimal" value="70,0" autocomplete="off">
                  <span>%</span>
                </div>
              </div>
            </div>

            <div class="row">
              <div>
                <div class="label">Grenzsteuersatz</div>
                <div class="hint">Vereinfachung: nur Einkommensteuer (ohne Soli/KiSt). Wirkt auf Steuerbox &amp; Liquidität nach Steuer.</div>
              </div>
              <div class="suffix"><input id="tax_pct" type="text" inputmode="decimal" value="42,0" autocomplete="off"><span>%</span></div>
            </div>

            <div class="ek-grid" style="margin-top:6px;">
              <div class="ekbox">
                <div class="label">Eigenkapital (%)</div>
                <div class="hint">Anteil vom Kaufpreis (ohne NK/Capex). Wird ignoriert, wenn EK (€) &gt; 0.</div>
                <div class="suffix">
                  <input id="ek_pct" type="text" inputmode="decimal" value="0" autocomplete="off">
                  <span>%</span>
                </div>
              </div>

              <div class="ekbox">
                <div class="label">Eigenkapital (€)</div>
                <div class="hint">Fixbetrag statt Prozent. Hat Vorrang, wenn &gt; 0.</div>
                <div class="suffix">
                  <input id="ek_eur" type="text" inputmode="numeric" value="0" autocomplete="off">
                  <span>€</span>
                </div>
              </div>
            </div>

            <div class="subhead">Kaufnebenkosten</div>

            <div class="row">
              <div><div class="label">Notar &amp; Grundbuch</div><div class="hint">in % vom Kaufpreis (Standardannahme: wird mitfinanziert).</div></div>
              <div class="suffix"><input id="nk_notar_pct" type="text" inputmode="decimal" value="0" autocomplete="off"><span>%</span></div>
            </div>

            <div class="row">
              <div><div class="label">Grunderwerbsteuer</div><div class="hint">in % vom Kaufpreis (Standardannahme: wird mitfinanziert).</div></div>
              <div class="suffix"><input id="nk_grest_pct" type="text" inputmode="decimal" value="0" autocomplete="off"><span>%</span></div>
            </div>

            <div class="row">
              <div><div class="label">Makler</div><div class="hint">optional, in % vom Kaufpreis (Standardannahme: wird mitfinanziert).</div></div>
              <div class="suffix"><input id="nk_makler_pct" type="text" inputmode="decimal" value="0" autocomplete="off"><span>%</span></div>
            </div>

            <!-- NEU: Finanzierung Kaufnebenkosten -->
            <div class="row" style="align-items:start;">
              <div>
                <div class="label">Kaufnebenkosten: Finanzierung</div>
                <div class="hint">Aus EK: erhöht eingesetztes Eigenkapital. Mitfinanziert: erhöht Kreditsumme und Rate.</div>

                <div class="chip-row" role="group" aria-label="Finanzierung Kaufnebenkosten">
                  <label class="chip">
                    <input type="radio" name="nkMode" value="debt" checked>
                    mitfinanziert <small>(Standard)</small>
                  </label>
                  <label class="chip">
                    <input type="radio" name="nkMode" value="equity">
                    aus Eigenkapital
                  </label>
                </div>
              </div>
              <div></div>
            </div>

            <div class="subhead">Modernisierung/Sanierung (Capex)</div>

            <div class="row">
              <div>
                <div class="label">Investitionsbudget gesamt</div>
                <div class="hint">Sanierung/Modernisierung zusammengefasst. Wirkt je nach Finanzierung auf Liquidität (EK) oder Rate (mitfinanziert).</div>
              </div>
              <div class="suffix">
                <input id="capex_total" type="text" inputmode="numeric" value="0" autocomplete="off">
                <span>€</span>
              </div>
            </div>

            <div class="row" style="align-items:start;">
              <div>
                <div class="label">Modernisierung/Sanierung: Finanzierung</div>
                <div class="hint">Aus EK: einmaliger Liquiditätsabfluss im Jahr 1 (vereinfachend). Über Kredit: Capex erhöht Kreditsumme und Annuität.</div>

                <div class="chip-row" role="group" aria-label="Finanzierung Capex">
                  <label class="chip">
                    <input type="radio" name="capexMode" value="equity" checked>
                    aus Eigenkapital <small>(Liquidität)</small>
                  </label>
                  <label class="chip">
                    <input type="radio" name="capexMode" value="debt">
                    mitfinanziert <small>(Rate)</small>
                  </label>
                </div>
              </div>
              <div></div>
            </div>

            <div class="row">
              <div>
                <div class="label">Miet-Boost nach Maßnahmen (optional)</div>
                <div class="hint">Zusätzliche Kaltmiete pro Monat durch Maßnahmen (wirkt direkt auf Cashflow/Miete).</div>
              </div>
              <div class="suffix">
                <input id="capex_rent_uplift" type="text" inputmode="numeric" value="0" autocomplete="off">
                <span>€</span>
              </div>
            </div>

            <p class="small" id="out_capex_note"></p>

            <h2 style="margin-top:18px;">Berechnung der Rate</h2>

            <div class="row">
              <div><div class="label">Zins</div><div class="hint">Nominalzins p.a. (für Annuitätenrate &amp; Steuerbox-Zinsen).</div></div>
              <div class="suffix"><input id="zins_pct" type="text" inputmode="decimal" value="0" autocomplete="off"><span>%</span></div>
            </div>

            <div class="row">
              <div><div class="label">Tilgung</div><div class="hint">Anfängliche Tilgung p.a. (Rate = Kredit * (Zins+Tilgung)/12).</div></div>
              <div class="suffix"><input id="tilgung_pct" type="text" inputmode="decimal" value="0" autocomplete="off"><span>%</span></div>
            </div>

            <!-- "Cashflow" Überschrift entfernt -->

            <div class="subhead">Miete (Start / Soll)</div>

            <div class="row">
              <div><div class="label">Wohnfläche</div><div class="hint">m². Relevant für Miete €/m² sowie Instandhaltungsrücklage €/m².</div></div>
              <div class="suffix"><input id="wf" type="text" inputmode="decimal" value="0" autocomplete="off"><span>m²</span></div>
            </div>

            <div class="row" style="border-bottom:none; padding-bottom:0;">
              <div>
                <div class="label">Miete €/m²</div>
                <div class="hint">Bidirektional: €/m² ↔ Monat ↔ Jahr (immer synchronisiert).</div>
              </div>
              <div class="suffix"><input id="miete_qm" type="text" inputmode="decimal" value="0" autocomplete="off"><span>€</span></div>
            </div>

            <div class="row" style="align-items:start; border-bottom:1px solid rgba(0,0,0,.10); padding-top: 10px;">
              <div>
                <div class="label">Alternative Mieteingabe</div>
                <div class="hint">Wähle nur die Anzeige. Die Felder sind immer gegenseitig berechenbar.</div>

                <div class="chip-row" role="group" aria-label="Mieteingabe">
                  <label class="chip">
                    <input type="radio" name="rentInputMode" value="perqm" checked>
                    €/m² <small>(Standard)</small>
                  </label>
                  <label class="chip">
                    <input type="radio" name="rentInputMode" value="month">
                    Monat <small>(Netto kalt)</small>
                  </label>
                  <label class="chip">
                    <input type="radio" name="rentInputMode" value="year">
                    Jahr <small>(Netto kalt)</small>
                  </label>
                </div>

                <div id="rent_month_box" style="display:none; margin-top:10px;">
                  <div class="hint">Netto-Kaltmiete pro Monat (Soll). Miet-Boost wird zusätzlich addiert.</div>
                  <div class="suffix" style="max-width:220px;">
                    <input id="miete_monat" type="text" inputmode="numeric" value="0" autocomplete="off">
                    <span>€</span>
                  </div>
                </div>

                <div id="rent_year_box" style="display:none; margin-top:10px;">
                  <div class="hint">Netto-Kaltmiete pro Jahr (Soll). Miet-Boost wird zusätzlich addiert (auf Monatsbasis).</div>
                  <div class="suffix" style="max-width:220px;">
                    <input id="miete_jahr" type="text" inputmode="numeric" value="0" autocomplete="off">
                    <span>€</span>
                  </div>
                </div>

                <p class="small" id="rent_input_note" style="margin-top:10px;"></p>
              </div>
              <div></div>
            </div>

            <div class="subhead">Nicht umlagefähige Nebenkosten (Schätzung)</div>

            <div class="row">
              <div><div class="label">Instandhaltungsrücklage</div><div class="hint">€/m² pro Monat (Liquidität: ja, Steuer: nein).</div></div>
              <div class="suffix"><input id="ih_qm" type="text" inputmode="decimal" value="0" autocomplete="off"><span>€</span></div>
            </div>

            <div class="row">
              <div><div class="label">Verwaltung (pro Monat)</div><div class="hint">Nicht umlagefähige Verwaltung (Liquidität: ja, Steuer: ja).</div></div>
              <div class="suffix">
                <input id="verw" type="text" inputmode="numeric" value="0" autocomplete="off">
                <span>€</span>
              </div>
            </div>

            <div class="subhead">Szenario</div>

            <div class="row" style="margin-bottom:0;">
              <div><div class="label">Betrachtungsjahr</div><div class="hint">Jahr 1–20: bestimmt Miete/Steuerbox/KPIs für dieses Jahr.</div></div>
              <div class="suffix">
                <input id="view_year" type="text" inputmode="numeric" value="1" autocomplete="off">
                <span>J</span>
              </div>
            </div>

            <div class="subhead" style="margin-top:14px;">Annahmen (wirken auf Ergebnisse &amp; Diagramme)</div>

            <div class="ek-grid">
              <div class="ekbox">
                <div class="label">Angenommene Wertsteigerung</div>
                <div class="hint">p.a. in % (nur Wertkurve, nicht Cashflow).</div>
                <div class="suffix">
                  <input id="ass_wert_pct" type="text" inputmode="decimal" value="2,0" autocomplete="off">
                  <span>%</span>
                </div>
              </div>

              <div class="ekbox">
                <div class="label">Angenommener Mietausfall</div>
                <div class="hint">% vom Soll (reduziert Miete = Ist).</div>
                <div class="suffix">
                  <input id="ass_ausfall_pct" type="text" inputmode="decimal" value="0,0" autocomplete="off">
                  <span>%</span>
                </div>
              </div>
            </div>

            <div class="row" style="border-bottom:none; padding-bottom:0;">
              <div>
                <div class="label">Mietsteigerung</div>
                <div class="hint">Entweder jährlich p.a. oder in 3-Jahres-Blöcken (Kappungslogik vereinfacht als Sprung).</div>

                <div style="display:flex; gap:12px; margin:10px 0 10px; align-items:center; flex-wrap:nowrap;">
                  <label style="display:flex; align-items:center; gap:6px; font-weight:600; white-space:nowrap;">
                    <input type="radio" name="rentMode" value="pa" checked>
                    Jährlich
                  </label>
                  <label style="display:flex; align-items:center; gap:6px; font-weight:600; white-space:nowrap;">
                    <input type="radio" name="rentMode" value="3y">
                    % innerhalb&nbsp;3&nbsp;Jahren&nbsp;(Kappungsgrenze)
                  </label>
                </div>

                <div id="rent_pa_box">
                  <div class="hint">jährliche Steigerung p.a.</div>
                  <div class="suffix" style="max-width:220px;">
                    <input id="ass_miete_pct" type="text" inputmode="decimal" value="2,0" autocomplete="off">
                    <span>%</span>
                  </div>
                </div>

                <div id="rent_3y_box" style="display:none;">
                  <div class="hint">Gesamtsteigerung je 3 Jahre in % (z.B. 15%)</div>
                  <div class="suffix" style="max-width:220px;">
                    <input id="ass_miete_3y_pct" type="text" inputmode="decimal" value="0,0" autocomplete="off">
                    <span>%</span>
                  </div>
                </div>
              </div>
              <div></div>
            </div>

            <div class="kpi-divider"></div>

            <div class="btnrow controls">
              <div class="btncol">
                <button class="btn ghost" type="button" id="resetBtn">Zurücksetzen</button>

                <button class="btn ghost" type="button" id="leipzigDefaultsBtn">Leipzig-Defaults</button>
                <button class="btn ghost" type="button" id="halleDefaultsBtn">Halle-Defaults</button>
                <button class="btn ghost" type="button" id="dresdenDefaultsBtn">Dresden-Defaults</button>
              </div>

              <div class="btncol right">
                <button class="btn ghost" type="button" id="copyBtn">Ergebnisse kopieren</button>
              </div>
            </div>

          </div>
        </section>

        <aside class="panel" aria-label="Ergebnisse">
          <h2>Ergebnisse</h2>

          <div class="result">
            <div class="kpi">
              <div>
                <div class="name">Kaufnebenkosten (Summe)</div>
                <div class="hint">Notar+Grundbuch, GrESt, Makler (aus Prozenten berechnet).</div>
              </div>
              <div class="val" id="out_nk_sum">0,00&nbsp;€</div>
            </div>

            <div class="kpi">
              <div><div class="name">Notar &amp; Grundbuch</div><div class="hint">abgeleitet aus Kaufpreis * %.</div></div>
              <div class="val" id="out_nk_notar_line">0,00&nbsp;€</div>
            </div>
            <div class="kpi">
              <div><div class="name">Grunderwerbsteuer</div><div class="hint">abgeleitet aus Kaufpreis * %.</div></div>
              <div class="val" id="out_nk_grest_line">0,00&nbsp;€</div>
            </div>
            <div class="kpi">
              <div><div class="name">Makler</div><div class="hint">abgeleitet aus Kaufpreis * %.</div></div>
              <div class="val" id="out_nk_makler_line">0,00&nbsp;€</div>
            </div>

            <div class="kpi-divider"></div>

            <div class="kpi">
              <div><div class="name">Eigenkapital (Kauf)</div><div class="hint">EK-Anteil nur auf Kaufpreis (ohne NK/Capex).</div></div>
              <div class="val" id="out_ek">0,00&nbsp;€</div>
            </div>

            <!-- NEU: NK aus EK -->
            <div class="kpi">
              <div><div class="name">Zus. EK für Kaufnebenkosten</div><div class="hint">Nur wenn NK „aus Eigenkapital“ gewählt ist.</div></div>
              <div class="val" id="out_nk_ek">0,00&nbsp;€</div>
            </div>

            <div class="kpi">
              <div><div class="name">Zus. EK für Investition (Capex)</div><div class="hint">Nur wenn Capex „aus Eigenkapital“ gewählt ist.</div></div>
              <div class="val" id="out_capex_ek">0,00&nbsp;€</div>
            </div>
            <div class="kpi">
              <div><div class="name">EK gesamt</div><div class="hint">Eigenkapital (Kauf) + ggf. NK-EK + ggf. Capex-EK.</div></div>
              <div class="val" id="out_ek_total">0,00&nbsp;€</div>
            </div>

            <div class="kpi-divider"></div>

            <div class="kpi">
              <div><div class="name">Kredit</div><div class="hint">(Kaufpreis − EK) + NK (wenn mitfinanziert) + ggf. Capex (mitfinanziert).</div></div>
              <div class="val" id="out_kredit">0,00&nbsp;€</div>
            </div>
            <div class="kpi">
              <div><div class="name">Rate</div><div class="hint">Annuität: Kredit * (Zins+Tilgung)/12.</div></div>
              <div class="val" id="out_rate">0,00&nbsp;€ / Monat</div>
            </div>

            <div class="kpi-divider"></div>

            <div class="kpi">
              <div><div class="name">Miete (Betrachtungsjahr)</div><div class="hint">Soll-Miete im Betrachtungsjahr inkl. Mietsteigerung und Miet-Boost (vor Mietausfall).</div></div>
              <div class="val" id="out_miete_y">0,00&nbsp;€ / Monat</div>
            </div>
            <div class="kpi">
              <div><div class="name">Nicht umlagefähige NK</div><div class="hint">Instandhaltungsrücklage + Verwaltung (monatlich).</div></div>
              <div class="val" id="out_nuk">0,00&nbsp;€ / Monat</div>
            </div>

            <div class="kpi-divider"></div>

            <div class="kpi">
              <div><div class="name">Kaufpreis je m²</div><div class="hint">Kaufpreis / Wohnfläche.</div></div>
              <div class="val" id="out_price_qm">—</div>
            </div>
            <div class="kpi">
              <div><div class="name">Kaufpreisfaktor</div><div class="hint">Kaufpreis / Jahreskaltmiete (Start).</div></div>
              <div class="val" id="out_price_factor">—</div>
            </div>

            <div class="kpi-divider"></div>

            <div class="kpi" id="kpi_cashflow_bt">
              <div>
                <div class="name">Cashflow (vor Steuer)</div>
                <div class="hint">Ist-Miete − Rate − nicht umlagefähige NK − ggf. Capex-Cash-Out (vereinfacht in Jahr 1).</div>
              </div>
              <div class="val" id="out_cashflow_bt">0,00&nbsp;€ / Monat</div>
            </div>

            <div class="kpi">
              <div><div class="name">AfA (p.a.)</div><div class="hint">AfA-Basis (KP+NK * Gebäudeanteil + ggf. aktivierter Capex) * AfA-Satz.</div></div>
              <div class="val" id="out_afa">0,00&nbsp;€</div>
            </div>
            <div class="kpi">
              <div><div class="name">Steuerwirkung (p.a.)</div><div class="hint">Vereinfachte Steuerzahlung (-) / Rückerstattung (+) aus steuerlichem Ergebnis.</div></div>
              <div class="val" id="out_tax_effect">0,00&nbsp;€</div>
            </div>

            <div class="kpi" id="kpi_liq_at">
              <div>
                <div class="name">Liquidität (nach Steuer)</div>
                <div class="hint">Cashflow (vor Steuer) + Steuerwirkung (auf Monatsbasis).</div>
              </div>
              <div class="val" id="out_liq_at">0,00&nbsp;€ / Monat</div>
            </div>

            <div class="kpi">
              <div><div class="name">Liquidität (nach Steuer, p.a.)</div><div class="hint">Liquidität nach Steuer pro Jahr.</div></div>
              <div class="val" id="out_liq_at_y">0,00&nbsp;€</div>
            </div>

            <div class="taxbox" aria-label="Steuerbox">
              <h3>Steuerliche Betrachtung <span style="font-weight:600; opacity:.85;">(Betrachtungsjahr: <span id="tax_year_label">1</span>)</span></h3>

              <div class="taxgrid">
                <div class="k">Einnahmen (Kaltmiete)</div><div class="v" id="tax_in_rent">0,00 €</div>
              </div>

              <div class="taxline"></div>

              <div class="taxgrid">
                <div class="k">Ausgaben: Abschreibung Immobilie (AfA)</div><div class="v" id="tax_out_afa">0,00 €</div>
                <div class="k">Ausgaben: Capex (sofort) / AfA (wenn aktiviert)</div><div class="v" id="tax_out_capex_immediate">0,00 €</div>
                <div class="k">Ausgaben: Hausverwaltung</div><div class="v" id="tax_out_admin">0,00 €</div>
                <div class="k">Ausgaben: Zinsen</div><div class="v" id="tax_out_interest">0,00 €</div>
              </div>

              <div class="taxline"></div>

              <div class="taxgrid">
                <div class="k"><b>Steuerliches Ergebnis</b></div><div class="v" id="tax_profit"><b>0,00 €</b></div>
                <div class="k"><b>Steuerzahlung (-) / Rückerstattung (+)</b></div><div class="v" id="tax_effect"><b>0,00 €</b></div>
              </div>

              <div class="taxhint" id="tax_hint">
                Modell: Instandhaltungsrücklage ist Liquiditätsabfluss, aber steuerlich nicht absetzbar.
                Capex wird vereinfacht behandelt: entweder sofort abziehbar (Erhaltungsaufwand) oder aktiviert (AfA-Basis).
              </div>
            </div>

            <div class="kpi-divider"></div>

            <div class="kpi">
              <div><div class="name">Cashflow-Rendite (vor Steuer, p.a.)</div><div class="hint">Cashflow vor Steuer (p.a.) / EK gesamt.</div></div>
              <div class="val" id="out_cf_yield">—</div>
            </div>
            <div class="kpi">
              <div><div class="name">Eigenkapitalrendite (vor Steuer, p.a.)</div><div class="hint">(Cashflow vor Steuer p.a. + Tilgung p.a.) / EK gesamt.</div></div>
              <div class="val" id="out_roe">—</div>
            </div>

            <div class="btnrow">
              <a class="btn" href="#kontakt">Objekt prüfen lassen</a>
            </div>

            <p class="small" id="out_note"></p>
          </div>
        </aside>

      </div>
    </div>
  </main>

  <!-- Prognose / Preise / Kontakt / Footer bleiben unverändert -->
  <section class="frame-gap" id="prognose">
    <div class="container">
      <div class="section-title">Prognose (20 Jahre)</div>

      <div class="forecast-panel">
        <h2>Liquidität nach Steuer &amp; Wertentwicklung</h2>

        <div class="chart-wrap">
          <p class="chart-title">Entwicklung (jährlich)</p>
          <canvas id="chartCashflow" aria-label="Liquidität nach Steuer / Miete p.a." role="img"></canvas>
          <div class="chart-note">
            Linie 1: Liquidität nach Steuer p.a. (inkl. Steuerwirkung, inkl. Mietausfall).
            Linie 2: Miete p.a. (Soll, ohne Mietausfall).
          </div>
        </div>

        <div class="chart-wrap">
          <p class="chart-title">Wertentwicklung vs. Restschuld (jährlich)</p>
          <canvas id="chartValueDebt" aria-label="Wert vs Restschuld" role="img"></canvas>
          <div class="chart-note">
            Restschuld: Annuität mit konstanter Rate. Wert: Kaufpreis (ohne NK/Capex) mit Wertsteigerung (p.a.).
          </div>
        </div>

        <div class="chart-wrap" aria-label="Beschreibung Eingaben und Ausgaben">
          <p class="chart-title">Feldbeschreibung (vollständig)</p>

          <div class="desc-wrap">
            <div class="desc-block">
              <h3>Eingaben</h3>
              <ul>
                <li><code>Kaufpreis</code>: Basis für Kredit, EK und Kennzahlen (ohne NK/Capex).</li>
                <li><code>Baujahr</code>: bestimmt AfA-Satz (vereinfachtes Modell).</li>
                <li><code>Gebäudeanteil (%)</code>: Anteil der AK, der als Gebäude (AfA) angesetzt wird.</li>
                <li><code>Grenzsteuersatz</code>: steuert Steuerwirkung (ohne Soli/KiSt).</li>
                <li><code>Eigenkapital (%)</code>: EK-Anteil vom Kaufpreis (ignoriert bei EK € &gt; 0).</li>
                <li><code>Eigenkapital (€)</code>: Fixbetrag, hat Vorrang vor EK %.</li>
                <li><code>Notar &amp; Grundbuch (%)</code>: Kaufnebenkosten.</li>
                <li><code>Grunderwerbsteuer (%)</code>: Kaufnebenkosten.</li>
                <li><code>Makler (%)</code>: optional, Kaufnebenkosten.</li>
                <li><code>Finanzierung Kaufnebenkosten</code>: aus EK vs. mitfinanziert (wirkt auf EK gesamt, Kredit, Rate).</li>
                <li><code>Investitionsbudget gesamt</code>: Capex – je nach Finanzierung Cash-Out oder Rate.</li>
                <li><code>Finanzierung der Investition</code>: EK (Liquidität) vs. mitfinanziert (Kredit/Rate).</li>
                <li><code>Miet-Boost (optional)</code>: zusätzliche monatliche Kaltmiete durch Maßnahmen.</li>
                <li><code>Zins</code>: Nominalzins p.a. für Rate, Zinsen in Steuerbox und Restschuldkurve.</li>
                <li><code>Tilgung</code>: anfängliche Tilgung p.a. für Annuitätenrate.</li>
                <li><code>Wohnfläche</code>: m² für Miete €/m² und Rücklage €/m².</li>
                <li><code>Miete €/m²</code>: Soll-Kaltmiete pro m² (wird aus Monat/Jahr berechnet, wenn dort zuletzt geändert).</li>
                <li><code>Miete Monat</code>: alternative Soll-Netto-Kaltmiete pro Monat.</li>
                <li><code>Miete Jahr</code>: alternative Soll-Netto-Kaltmiete pro Jahr.</li>
                <li><code>Instandhaltungsrücklage €/m²</code>: Liquiditätsabfluss, steuerlich nicht absetzbar (vereinfachend).</li>
                <li><code>Verwaltung (Monat)</code>: nicht umlagefähige Verwaltung, steuerlich absetzbar.</li>
                <li><code>Betrachtungsjahr</code>: Jahr (1–20) für KPIs/Steuerbox und „Miete im Jahr“.</li>
                <li><code>Wertsteigerung</code>: beeinflusst nur die Wertkurve (nicht Cashflow).</li>
                <li><code>Mietausfall</code>: reduziert Soll-Miete zu Ist-Miete (wirkt direkt auf Cashflow).</li>
                <li><code>Mietsteigerung</code>: jährlich p.a. oder 3-Jahres-Block (Sprungmodell).</li>
              </ul>
            </div>

            <div class="desc-block">
              <h3>Ausgaben/Ergebnisse</h3>
              <ul>
                <li><code>Kaufnebenkosten (Summe)</code>: Notar+GrESt+Makler (aus % berechnet).</li>
                <li><code>Eigenkapital (Kauf)</code>: EK-Anteil am Kaufpreis.</li>
                <li><code>Zus. EK NK</code>: NK aus EK (nur bei NK=EK).</li>
                <li><code>Zus. EK Capex</code>: Capex als EK (nur bei Capex=EK).</li>
                <li><code>EK gesamt</code>: EK (Kauf) + ggf. NK-EK + ggf. Capex-EK.</li>
                <li><code>Kredit</code>: (Kaufpreis − EK) + NK (wenn mitfinanziert) + ggf. Capex (mitfinanziert).</li>
                <li><code>Rate</code>: Annuität pro Monat (Zins+Tilgung).</li>
                <li><code>Miete (Betrachtungsjahr)</code>: Soll-Miete im Jahr (inkl. Mietsteigerung + Miet-Boost).</li>
                <li><code>Nicht umlagefähige NK</code>: Rücklage + Verwaltung (monatlich).</li>
                <li><code>Kaufpreis je m²</code>: Kaufpreis / Wohnfläche.</li>
                <li><code>Kaufpreisfaktor</code>: Kaufpreis / Jahreskaltmiete (Start).</li>
                <li><code>Cashflow (vor Steuer)</code>: Ist-Miete − Rate − nicht umlagefähige NK − ggf. Capex-Cash-Out (Jahr 1).</li>
                <li><code>AfA (p.a.)</code>: Abschreibung aus AfA-Basis und AfA-Satz.</li>
                <li><code>Steuerwirkung (p.a.)</code>: vereinfachte Steuerzahlung (-) / Rückerstattung (+).</li>
                <li><code>Liquidität (nach Steuer)</code>: Cashflow vor Steuer + Steuerwirkung (monatlich).</li>
                <li><code>Liquidität (nach Steuer, p.a.)</code>: Liquidität nach Steuer pro Jahr.</li>
                <li><code>Steuerbox</code>: zeigt Einnahmen, AfA, Capex (sofort), Verwaltung, Zinsen, Ergebnis und Steuerwirkung.</li>
                <li><code>Cashflow-Rendite</code>: Cashflow vor Steuer p.a. / EK gesamt.</li>
                <li><code>Eigenkapitalrendite</code>: (Cashflow p.a. + Tilgung p.a.) / EK gesamt.</li>
              </ul>
            </div>
          </div>

          <div class="chart-note">
            Hinweis: bewusst vereinfacht (keine umlagefähigen NK, keine Soli/KiSt, Capex steuerlich nur als Näherung, Mietsteigerung 3y als Sprung).
          </div>
        </div>

      </div>
    </div>
  </section>

  <section class="frame-gap" id="preise">
    <div class="container">
      <div class="section-title">Beratungsleistungen</div>
      <div class="pricing-panel">
        <div class="price-table">
          <div class="price-col">
            <div class="kicker">Kostenloser Objektcheck</div>
            <div class="price">€0</div>
            <div class="sub">pro Projekt</div>
            <div class="col-cta"><a class="btn" href="#kontakt">Kontakt</a></div>
            <div class="col-desc">Ziel des kostenlosen Objektchecks ist eine klare wirtschaftliche Ersteinschätzung der Immobilie.</div>
            <ul class="checks">
              <li><span class="dot"></span><span>Kurzbewertung der Immobilie</span></li>
              <li><span class="dot"></span><span>Top 3 Optimierungshebel</span></li>
              <li><span class="dot"></span><span>Klare Empfehlungen</span></li>
            </ul>
          </div>

          <div class="price-col">
            <div class="kicker">Ankaufsberatung</div>
            <div class="price">auf Anfrage</div>
            <div class="sub">pro Projekt</div>
            <div class="col-cta"><a class="btn" href="#kontakt">Kontakt</a></div>
            <div class="col-desc">Erhebliche Einsparpotenziale durch realistische Preiseinschätzung und Identifikation versteckter Risiken.</div>
            <ul class="checks">
              <li><span class="dot"></span><span>Standort- und Mikrolagenbewertung</span></li>
              <li><span class="dot"></span><span>Analyse der bestehenden Mieten und Potenziale</span></li>
              <li><span class="dot"></span><span>Prüfung der vorhandenen Unterlagen</span></li>
              <li><span class="dot"></span><span>Klare Entscheidungsempfehlung</span></li>
              <li><span class="dot"></span><span>Optional: Kontakt zu Maklern / Dienstleistern</span></li>
              <li><span class="dot"></span><span>Optional: Durchführung von Besichtigungen</span></li>
            </ul>
          </div>

          <div class="price-col">
            <div class="kicker">Objektoptimierung &amp; Strategie</div>
            <div class="price">auf Anfrage</div>
            <div class="sub">pro Projekt</div>
            <div class="col-cta"><a class="btn" href="#kontakt">Kontakt</a></div>
            <div class="col-desc">Maximierung der wirtschaftlichen Ergebnisse. Durch strukturierte Immobilienoptimierung werden Betriebskosten reduziert und Erträge langfristig gesteigert.</div>
            <ul class="checks">
              <li><span class="dot"></span><span>Analyse von Mietniveau und Erlösstruktur</span></li>
              <li><span class="dot"></span><span>Prüfung laufender Kosten und Dienstleistern</span></li>
              <li><span class="dot"></span><span>Bewertung von Optimierungs- und Entwicklungspotenzialen</span></li>
              <li><span class="dot"></span><span>Priorisierung wirtschaftlich sinnvoller Maßnahmen</span></li>
              <li><span class="dot"></span><span>Optional: Prüfung der aktuellen Hausverwaltung</span></li>
            </ul>
          </div>

          <div class="price-col">
            <div class="kicker">Verkaufsberatung</div>
            <div class="price">auf Anfrage</div>
            <div class="sub">pro Projekt</div>
            <div class="col-cta"><a class="btn" href="#kontakt">Kontakt</a></div>
            <div class="col-desc">Immobilien werden nicht zum Angebotspreis gekauft. Deshalb ist eine strategische Verkaufsvorbereitung zur Erzielung des optimalen Marktpreises enorm wichtig. Auf Wunsch auch mit Begleitung des Eigenverkaufs ohne Makler (objektabhängig).</div>
            <ul class="checks">
              <li><span class="dot"></span><span>Analyse der Verkaufsreife und Ausgangslage</span></li>
              <li><span class="dot"></span><span>Bewertung sinnvoller Maßnahmen vor dem Verkauf</span></li>
              <li><span class="dot"></span><span>Einschätzung des optimalen Verkaufszeitpunkts</span></li>
              <li><span class="dot"></span><span>Vorbereitung relevanter Unterlagen</span></li>
              <li><span class="dot"></span><span>Strategische Beratung zur Preisfindung</span></li>
              <li><span class="dot"></span><span>Optional: Beratung bei Verkauf ohne Makler</span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="frame-gap" id="kontakt">
    <div class="container">
      <div class="section-title">Kontakt</div>

      <div class="panel">
        <h2 style="font-size:18px; margin:0 0 14px; letter-spacing:.2px;">Kontaktieren Sie mich</h2>

        <div class="contact-direct">
          <div class="contact-item">
            <span class="icon">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true">
                <path d="M6.6 10.8a15.05 15.05 0 006.6 6.6l2.2-2.2c.3-.3.8-.4 1.2-.3
                1.3.4 2.7.6 4.1.6.7 0 1.3.6 1.3 1.3V21c0 .7-.6 1.3-1.3 1.3
                C10.4 22.3 1.7 13.6 1.7 3.3 1.7 2.6 2.3 2 3 2h3.3
                c.7 0 1.3.6 1.3 1.3 0 1.4.2 2.8.6 4.1.1.4 0 .9-.3 1.2l-2.3 2.2z"/>
              </svg>
            </span>
            <a href="tel:+491607738676">+49 160 7738676</a>
          </div>

          <div class="contact-item">
            <span class="icon">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true">
                <path d="M2 4h20a2 2 0 012 2v12a2 2 0 01-2 2H2a2 2 0 01-2-2V6a2 2 0 012-2zm0 2v.01L12 13 22 6.01V6H2zm20 2.24l-9.4 6.27a1 1 0 01-1.2 0L2 8.24V18h20V8.24z"/>
              </svg>
            </span>
            <a href="mailto:grundmann.immoplus@gmail.com">grundmann.immoplus@gmail.com</a>
          </div>
        </div>

        <p style="margin-top:6px; color: var(--muted);">
          Eine kurze Einordnung genügt: Objekttyp oder Adresse, aktueller Status und die zentrale Fragestellung.
        </p>

        <form action="https://formspree.io/f/mvzqvggb" method="POST" id="kontakt-form">
          <div class="field">
            <label for="name">Name</label>
            <input id="name" name="Name" type="text" required style="text-align:left;">
          </div>

          <div class="field">
            <label for="email">E-Mail-Adresse</label>
            <input id="email" name="E-Mail" type="email" required style="text-align:left;">
          </div>

          <div class="field">
            <label for="phone">Telefonnummer (optional)</label>
            <input id="phone" name="Telefon" type="tel" style="text-align:left;">
          </div>

          <div class="field">
            <label for="message">Nachricht</label>
            <textarea id="message" name="Nachricht" required></textarea>
          </div>

          <button class="btn" type="submit" style="width:auto; border-radius:10px; padding:10px 14px;">Nachricht senden</button>

          <p id="form-success" style="display:none; margin-top:16px;">
            Vielen Dank für Ihre Nachricht. Ich melde mich zeitnah bei Ihnen.
          </p>
        </form>
      </div>
    </div>
  </section>

  <footer>
    <img class="footer-logo" src="/assets/Logo_Grundmann-Consulting.png" alt="Grundmann Consulting Logo">
    <div><a href="/impressum/">Impressum</a></div>
  </footer>

  <script>
    const nf2 = new Intl.NumberFormat('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    const nf2plain = new Intl.NumberFormat('de-DE', { maximumFractionDigits: 2 });
    const nfInt = new Intl.NumberFormat('de-DE', { maximumFractionDigits: 0 });

    const eur = (n) => nf2.format(n) + " €";
    const eurPerMonth = (n) => nf2.format(n) + " € / Monat";
    const pct = (n) => nf2plain.format(n) + " %";
    const el = (id) => document.getElementById(id);

    function parseDeNumber(str){
      if (str == null) return 0;
      let s = String(str).trim();
      if (!s) return 0;
      s = s.replace(/\./g, "").replace(/,/g, ".");
      s = s.replace(/[^0-9.\-]/g, "");
      const v = Number.parseFloat(s);
      return Number.isFinite(v) ? v : 0;
    }

    function numInput(input){
      return Math.max(0, parseDeNumber(input.value));
    }

    function getCapexMode(){
      return document.querySelector('input[name="capexMode"]:checked')?.value || "equity";
    }

    function getNkMode(){
      return document.querySelector('input[name="nkMode"]:checked')?.value || "debt";
    }

    function getRentInputMode(){
      return document.querySelector('input[name="rentInputMode"]:checked')?.value || "perqm";
    }

    function updateRentInputVisuals(){
      const mode = getRentInputMode();
      const qm = el("miete_qm");
      if (!qm) return;

      const auto = (mode !== "perqm");
      qm.classList.toggle("auto-muted", auto);
      qm.readOnly = auto;
      qm.setAttribute("aria-readonly", auto ? "true" : "false");
      qm.title = auto ? "Wird automatisch aus Monats-/Jahresmiete und Wohnfläche berechnet." : "";
    }

    function setRentInputMode(mode){
      const perqm = document.querySelector('input[name="rentInputMode"][value="perqm"]');
      const mon = document.querySelector('input[name="rentInputMode"][value="month"]');
      const yr = document.querySelector('input[name="rentInputMode"][value="year"]');
      if (!perqm || !mon || !yr) return;

      if (mode === "month") mon.checked = true;
      else if (mode === "year") yr.checked = true;
      else perqm.checked = true;

      const m = getRentInputMode();
      const boxM = el("rent_month_box");
      const boxY = el("rent_year_box");
      if (boxM) boxM.style.display = (m === "month") ? "block" : "none";
      if (boxY) boxY.style.display = (m === "year") ? "block" : "none";

      const note = el("rent_input_note");
      if (note){
        if (m === "perqm") note.textContent = "Berechnung: Monats-/Jahresmiete werden aus €/m² und Wohnfläche berechnet.";
        if (m === "month") note.textContent = "Berechnung: €/m² und Jahresmiete werden aus der Monatsmiete und Wohnfläche berechnet.";
        if (m === "year") note.textContent = "Berechnung: €/m² und Monatsmiete werden aus der Jahresmiete und Wohnfläche berechnet.";
      }

      updateRentInputVisuals();
    }

    const ids = [
      "kaufpreis","baujahr","geb_anteil_pct","tax_pct",
      "ek_pct","ek_eur","nk_notar_pct","nk_grest_pct","nk_makler_pct",
      "capex_total","capex_rent_uplift",
      "zins_pct","tilgung_pct",
      "wf","miete_qm","miete_monat","miete_jahr","ih_qm","verw",
      "view_year",
      "ass_wert_pct","ass_miete_pct","ass_miete_3y_pct","ass_ausfall_pct"
    ];

    const fmtNoGroupYearIds = new Set(["baujahr","view_year"]);
    const fmtIntIds = new Set(["kaufpreis","ek_eur","capex_total","capex_rent_uplift","verw","miete_monat","miete_jahr"]);
    const fmtDecIds = new Set([
      "geb_anteil_pct","tax_pct","ek_pct","nk_notar_pct","nk_grest_pct","nk_makler_pct","zins_pct","tilgung_pct",
      "wf","miete_qm","ih_qm","ass_wert_pct","ass_miete_pct","ass_miete_3y_pct","ass_ausfall_pct"
    ]);

    function formatValueForInput(id, v){
      if (!Number.isFinite(v)) v = 0;
      if (fmtNoGroupYearIds.has(id)) return String(Math.round(v));
      if (fmtIntIds.has(id)) return nfInt.format(Math.round(v));
      return nf2plain.format(v).replace(".", ",");
    }

    function formatInput(id){
      const node = el(id);
      if (!node) return;
      const v = parseDeNumber(node.value);
      node.value = formatValueForInput(id, v);
    }

    const rentSensitiveIds = new Set(["miete_qm","miete_monat","miete_jahr","wf"]);

    function attachAutoFormat(id, opts = {}){
      const node = el(id);
      if (!node) return;

      if (!opts.skipInputCalc){
        node.addEventListener("input", () => calc());
      }

      node.addEventListener("blur", () => {
        formatInput(id);
        calc();
      });
    }

    function attachShiftArrowBoost(input, baseStep){
      if (!input) return;
      input.addEventListener("keydown", (e) => {
        if (!e.shiftKey) return;
        if (e.key !== "ArrowUp" && e.key !== "ArrowDown") return;

        e.preventDefault();
        const v0 = parseDeNumber(input.value);
        const step = Number(baseStep || 1) || 1;
        const delta = (e.key === "ArrowUp" ? step : -step) * 10;
        const v = Math.max(0, v0 + delta);

        input.value = String(v).replace(".", ",");
        calc();
      });
    }

    function setRentMode(mode){
      const pa = document.querySelector('input[name="rentMode"][value="pa"]');
      const y3 = document.querySelector('input[name="rentMode"][value="3y"]');
      if (!pa || !y3) return;

      if (mode === "3y") y3.checked = true;
      else pa.checked = true;

      const m = document.querySelector('input[name="rentMode"]:checked')?.value || "pa";
      const boxPa = el("rent_pa_box");
      const box3y = el("rent_3y_box");
      if (boxPa) boxPa.style.display = (m === "pa") ? "block" : "none";
      if (box3y) box3y.style.display = (m === "3y") ? "block" : "none";
    }

    function getAfaRateFromYear(baujahr){
      const y = Math.round(Math.max(0, baujahr));
      return (y > 0 && y < 1925) ? 0.025 : 0.02;
    }

    function capexIsCapitalized(capexTotal, buildingBase){
      const threshold = Math.max(0, buildingBase) * 0.15;
      if (threshold <= 0) return false;
      return capexTotal > threshold && capexTotal > 0;
    }

    function rentSollMonatForYear(mieteStartMonat, y){
      if (y === 0) return mieteStartMonat;

      const rentMode = document.querySelector('input[name="rentMode"]:checked')?.value || "pa";
      if (rentMode === "3y"){
        const K = Math.max(0, parseDeNumber(el("ass_miete_3y_pct").value))/100;
        const blocks = Math.floor((y + 2) / 3);
        return mieteStartMonat * Math.pow(1 + K, blocks);
      }

      const g = Math.max(0, parseDeNumber(el("ass_miete_pct").value))/100;
      return mieteStartMonat * Math.pow(1 + g, y);
    }

    function debtAtStartOfYear(kredit0, z, rateMonat, y){
      let rest = Math.max(0, kredit0);
      if (y <= 0) return rest;

      for (let i = 0; i < y; i++){
        if (rest <= 0) return 0;
        const annuityYear = rateMonat * 12;
        const interestYear = rest * z;
        const principalYear = Math.max(0, annuityYear - interestYear);
        rest = Math.max(0, rest - principalYear);
      }
      return rest;
    }

    let chartCashflow = null;
    let chartValueDebt = null;
    function fmtYear(y){ return `Jahr ${y}`; }

    function buildProjection(state){
      const years = 20;

      const kaufpreis = state.kp;
      const kredit0 = state.kredit;
      const z = state.z;
      const rateMonat = state.rate;
      const nukMonat0 = state.nukSum;

      const wertWachstum = state.assWert;
      const ausfall = state.assAusfall;

      const mieteSollMonat0 = state.mieteMonat;

      const taxRate = state.taxRate;
      const afaRate = state.afaRate;
      const afaBaseBuildingAcq = state.afaBaseBuildingAcq;

      const capexTotal = state.capexTotal;
      const capexCap = state.capexCapitalized;
      const adminYearStatic = state.verwMonat * 12;

      const labels = [];
      const liqAfterTax = [];
      const rentYearly = [];
      const values = [];
      const debt = [];

      for (let y = 0; y <= years; y++){
        labels.push(fmtYear(y));
        values.push(kaufpreis * Math.pow(1 + wertWachstum, y));

        const mieteSollMonat = rentSollMonatForYear(mieteSollMonat0, y);
        const rentSollYear = mieteSollMonat * 12;
        rentYearly.push(rentSollYear);

        const rentIstYear = rentSollYear * (1 - ausfall);

        const restStart = debtAtStartOfYear(kredit0, z, rateMonat, y);
        debt.push(restStart);

        const annuityYear = rateMonat * 12;
        const interestYear = restStart * z;

        const capexCashOut = (y === 0 && state.capexMode === "equity") ? capexTotal : 0;

        const capexDeduct = (!capexCap && y === 0) ? capexTotal : 0;
        const capexAfaAdd = (capexCap ? capexTotal : 0);

        const afaYear = (afaBaseBuildingAcq + capexAfaAdd) * afaRate;

        const liqBT = rentIstYear - nukMonat0*12 - annuityYear - capexCashOut;

        const taxable = rentIstYear - adminYearStatic - interestYear - afaYear - capexDeduct;
        const taxEffect = -taxRate * taxable;

        liqAfterTax.push(liqBT + taxEffect);
      }

      return { labels, liqAfterTax, rentYearly, values, debt };
    }

    function upsertCharts(state){
      const c1 = el("chartCashflow");
      const c2 = el("chartValueDebt");
      if (!c1 || !c2 || typeof Chart === "undefined") return;

      const proj = buildProjection(state);
      const ctx1 = c1.getContext("2d");
      const ctx2 = c2.getContext("2d");

      const commonOptions = {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: "index", intersect: false },
        plugins: {
          legend: { display: true },
          tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ${nf2.format(ctx.parsed.y)} €` } }
        },
        scales: { y: { ticks: { callback: (v) => nf2.format(v) + " €" } } }
      };

      if (!chartCashflow){
        chartCashflow = new Chart(ctx1, {
          type: "line",
          data: {
            labels: proj.labels,
            datasets: [
              { label: "Liquidität nach Steuer p.a.", data: proj.liqAfterTax, tension: 0.25, pointRadius: 0 },
              { label: "Miete p.a. (Soll)", data: proj.rentYearly, tension: 0.25, pointRadius: 0 }
            ]
          },
          options: commonOptions
        });
      } else {
        chartCashflow.data.labels = proj.labels;
        chartCashflow.data.datasets[0].data = proj.liqAfterTax;
        chartCashflow.data.datasets[1].data = proj.rentYearly;
        chartCashflow.update();
      }

      if (!chartValueDebt){
        chartValueDebt = new Chart(ctx2, {
          type: "line",
          data: {
            labels: proj.labels,
            datasets: [
              { label: "Wert", data: proj.values, tension: 0.25, pointRadius: 0 },
              { label: "Restschuld", data: proj.debt, tension: 0.25, pointRadius: 0 }
            ]
          },
          options: commonOptions
        });
      } else {
        chartValueDebt.data.labels = proj.labels;
        chartValueDebt.data.datasets[0].data = proj.values;
        chartValueDebt.data.datasets[1].data = proj.debt;
        chartValueDebt.update();
      }
    }

    const forecastDefaults = { ass_wert_pct: "2,0", ass_miete_pct: "2,0", ass_miete_3y_pct: "0,0", ass_ausfall_pct: "0,0" };
    const defaultsZero = Object.fromEntries(ids.map(id => [id, "0"]));
    const defaultsCommon = {
      baujahr: "1900",
      geb_anteil_pct: "70,0",
      tax_pct: "42,0",
      capex_total: "0",
      capex_rent_uplift: "0",
      view_year: "1",
      ...forecastDefaults
    };

    const defaultsLeipzig = {
      kaufpreis: "200000",
      baujahr: "1900",
      geb_anteil_pct: "70,0",
      tax_pct: "42,0",
      ek_pct: "20",
      ek_eur: "0",
      nk_notar_pct: "2,0",
      nk_grest_pct: "5,5",
      nk_makler_pct: "0,0",
      capex_total: "0",
      capex_rent_uplift: "0",
      zins_pct: "2,7",
      tilgung_pct: "2,0",
      wf: "70",
      miete_qm: "9,0",
      miete_monat: "0",
      miete_jahr: "0",
      ih_qm: "1,0",
      verw: "30",
      view_year: "1",
      ...forecastDefaults
    };

    const defaultsHalle = {
      kaufpreis: "200000",
      baujahr: "1900",
      geb_anteil_pct: "70,0",
      tax_pct: "42,0",
      ek_pct: "20",
      ek_eur: "0",
      nk_notar_pct: "2,0",
      nk_grest_pct: "5,0",
      nk_makler_pct: "0,0",
      capex_total: "0",
      capex_rent_uplift: "0",
      zins_pct: "2,7",
      tilgung_pct: "2,0",
      wf: "70",
      miete_qm: "8,0",
      miete_monat: "0",
      miete_jahr: "0",
      ih_qm: "1,0",
      verw: "30",
      view_year: "1",
      ...forecastDefaults
    };

    const defaultsDresden = {
      kaufpreis: "200000",
      baujahr: "1900",
      geb_anteil_pct: "70,0",
      tax_pct: "42,0",
      ek_pct: "20",
      ek_eur: "0",
      nk_notar_pct: "2,0",
      nk_grest_pct: "5,5",
      nk_makler_pct: "0,0",
      capex_total: "0",
      capex_rent_uplift: "0",
      zins_pct: "2,7",
      tilgung_pct: "2,0",
      wf: "70",
      miete_qm: "10,0",
      miete_monat: "0",
      miete_jahr: "0",
      ih_qm: "1,0",
      verw: "30",
      view_year: "1",
      ...forecastDefaults
    };

    function applyDefaults(obj){
      Object.entries(obj).forEach(([k,v]) => { if (el(k)) el(k).value = String(v); });
      ids.forEach(id => formatInput(id));

      const cap = document.querySelector('input[name="capexMode"][value="equity"]');
      if (cap) cap.checked = true;

      const nk = document.querySelector('input[name="nkMode"][value="debt"]');
      if (nk) nk.checked = true;

      setRentInputMode("perqm");

      lastRentEdited = "perqm";
      syncRentFields();

      calc();
    }

    // =====================================================
    // ✅ BIDIREKTIONAL (Quelle = zuletzt geändertes Feld)
    // =====================================================
    let rentSyncLock = false;
    let lastRentEdited = "perqm"; // "perqm" | "month" | "year"

    function setIfNotActive(node, valueString){
      if (!node) return;
      if (document.activeElement === node) return;
      node.value = valueString;
    }

    function syncRentFields(){
      if (rentSyncLock) return;
      rentSyncLock = true;

      try{
        updateRentInputVisuals();

        const area = Math.max(0, parseDeNumber(el("wf")?.value));
        const qmEl = el("miete_qm");
        const monEl = el("miete_monat");
        const yrEl = el("miete_jahr");

        if (!qmEl || !monEl || !yrEl) return;

        const q = Math.max(0, parseDeNumber(qmEl.value));
        const m = Math.max(0, parseDeNumber(monEl.value));
        const y = Math.max(0, parseDeNumber(yrEl.value));

        if (lastRentEdited === "year"){
          const mon = y / 12;
          setIfNotActive(monEl, formatValueForInput("miete_monat", mon));
          if (area > 0){
            const rentqm = mon / area;
            setIfNotActive(qmEl, formatValueForInput("miete_qm", rentqm));
          }
          return;
        }

        if (lastRentEdited === "month"){
          setIfNotActive(yrEl, formatValueForInput("miete_jahr", m * 12));
          if (area > 0){
            setIfNotActive(qmEl, formatValueForInput("miete_qm", m / area));
          }
          return;
        }

        if (area > 0){
          const mon = q * area;
          setIfNotActive(monEl, formatValueForInput("miete_monat", mon));
          setIfNotActive(yrEl, formatValueForInput("miete_jahr", mon * 12));
        }
      } finally {
        rentSyncLock = false;
      }
    }
    // =====================================================

    function calc(){
      syncRentFields();

      const kp = numInput(el("kaufpreis"));

      const ekEurRaw = numInput(el("ek_eur"));
      let ekp = Math.min(100, Math.max(0, parseDeNumber(el("ek_pct").value)));
      let ek = kp * (ekp/100);

      if (ekEurRaw > 0){
        ek = Math.min(kp, ekEurRaw);
        ekp = (kp > 0) ? (ek / kp) * 100 : 0;
      }

      const notarPct = Math.max(0, parseDeNumber(el("nk_notar_pct").value));
      const grestPct = Math.max(0, parseDeNumber(el("nk_grest_pct").value));
      const maklerPct = Math.max(0, parseDeNumber(el("nk_makler_pct").value));

      const notar = kp * (notarPct/100);
      const grest = kp * (grestPct/100);
      const makler = kp * (maklerPct/100);
      const nkSum = notar + grest + makler;

      const nkMode = getNkMode();
      const nkEk = (nkMode === "equity") ? nkSum : 0;
      const nkDebt = (nkMode === "debt") ? nkSum : 0;

      const capexTotal = numInput(el("capex_total"));
      const capexMode = getCapexMode();
      const capexRentUplift = numInput(el("capex_rent_uplift"));

      const capexEk = (capexMode === "equity") ? capexTotal : 0;
      const capexDebt = (capexMode === "debt") ? capexTotal : 0;

      const kredit = Math.max(0, (kp - ek) + nkDebt + capexDebt);

      const z = Math.max(0, parseDeNumber(el("zins_pct").value))/100;
      const t = Math.max(0, parseDeNumber(el("tilgung_pct").value))/100;
      const rate = kredit * (z + t) / 12;

      const area = Math.max(0, parseDeNumber(el("wf").value));

      const rentQmEff = Math.max(0, parseDeNumber(el("miete_qm").value));
      const mieteMonat0_base = (area > 0) ? (area * rentQmEff) : 0;

      const mieteMonat0 = mieteMonat0_base + capexRentUplift;

      const ihqm = Math.max(0, parseDeNumber(el("ih_qm").value));
      const ruecklageMonat = area * ihqm;

      const verwMonat = numInput(el("verw"));
      const nukSum = ruecklageMonat + verwMonat;

      const baujahr = Math.round(Math.max(0, parseDeNumber(el("baujahr").value)));
      const gebAnteil = Math.min(100, Math.max(0, parseDeNumber(el("geb_anteil_pct").value))) / 100;
      const afaRate = getAfaRateFromYear(baujahr);

      const afaBaseBuildingAcq = (kp + nkSum) * gebAnteil;
      const capexCap = capexIsCapitalized(capexTotal, afaBaseBuildingAcq);
      const capexAfaAdd = capexCap ? capexTotal : 0;
      const capexDeductImmediate = capexCap ? 0 : capexTotal;

      const capexNote = (capexTotal <= 0)
        ? ""
        : `Capex: ${eur(capexTotal)} | Finanzierung: ${capexMode === "equity" ? "Eigenkapital (einmalig)" : "mitfinanziert (Rate)"} | steuerlich: ${capexCap ? "Aktivierung (AfA)" : "Sofort (vereinfachend)"}`;
      if (el("out_capex_note")) el("out_capex_note").textContent = capexNote;

      const viewYearRaw = parseDeNumber(el("view_year")?.value);
      const viewYear = Math.max(1, Math.min(20, Math.round(viewYearRaw || 1)));
      if (el("tax_year_label")) el("tax_year_label").textContent = String(viewYear);
      const vyEl = el("view_year");
      if (vyEl && document.activeElement !== vyEl) vyEl.value = String(viewYear);

      const assAusfall = Math.min(100, Math.max(0, parseDeNumber(el("ass_ausfall_pct").value)))/100;

      const mieteMonatY = rentSollMonatForYear(mieteMonat0, viewYear);
      const rentSollYear = mieteMonatY * 12;
      const rentIstYear = rentSollYear * (1 - assAusfall);

      const restStart = debtAtStartOfYear(kredit, z, rate, viewYear);
      const annuityYear = rate * 12;
      const interestYear = restStart * z;

      const afaYear = (afaBaseBuildingAcq + capexAfaAdd) * afaRate;

      const adminYear = verwMonat * 12;
      const taxRate = Math.min(100, Math.max(0, parseDeNumber(el("tax_pct").value))) / 100;

      const capexDeductInYear = (!capexCap && viewYear === 1) ? capexDeductImmediate : 0;

      const taxable = rentIstYear - interestYear - adminYear - afaYear - capexDeductInYear;
      const taxEffect = -taxRate * taxable;

      const capexCashOutYear = (capexMode === "equity" && viewYear === 1) ? capexTotal : 0;
      const liqBT = rentIstYear - annuityYear - (nukSum*12) - capexCashOutYear;
      const liqAT = liqBT + taxEffect;

      const cashflowBT_mon = liqBT / 12;
      const liqAT_mon = liqAT / 12;

      const ekTotal = ek + nkEk + capexEk;

      const cfYield = ekTotal > 0 ? (cashflowBT_mon * 12 / ekTotal) * 100 : null;
      const tilgungP_a = kredit * t;
      const roe = ekTotal > 0 ? ((cashflowBT_mon * 12 + tilgungP_a) / ekTotal) * 100 : null;

      el("out_nk_sum").textContent = eur(nkSum);
      el("out_nk_notar_line").textContent = eur(notar);
      el("out_nk_grest_line").textContent = eur(grest);
      el("out_nk_makler_line").textContent = eur(makler);

      el("out_ek").textContent = eur(ek);
      el("out_nk_ek").textContent = eur(nkEk);
      el("out_capex_ek").textContent = eur(capexEk);
      el("out_ek_total").textContent = eur(ekTotal);

      el("out_kredit").textContent = eur(kredit);
      el("out_rate").textContent = eurPerMonth(rate);

      el("out_miete_y").textContent = eurPerMonth(mieteMonatY);
      el("out_nuk").textContent = eurPerMonth(nukSum);

      el("out_price_qm").textContent = (area > 0 && kp > 0) ? (nf2.format(kp / area) + " € / m²") : "—";

      const annualRentStartFromQm = (area * rentQmEff) * 12;
      el("out_price_factor").textContent = (kp > 0 && annualRentStartFromQm > 0) ? (nf2plain.format(kp / annualRentStartFromQm) + " x") : "—";

      el("out_cashflow_bt").textContent = eurPerMonth(cashflowBT_mon);
      el("out_afa").textContent = eur(afaYear);
      el("out_tax_effect").textContent = eur(taxEffect);
      el("out_liq_at").textContent = eurPerMonth(liqAT_mon);
      el("out_liq_at_y").textContent = eur(liqAT);

      el("tax_in_rent").textContent = eur(rentIstYear);
      el("tax_out_afa").textContent = eur(afaYear);
      el("tax_out_capex_immediate").textContent = eur(capexDeductInYear);
      el("tax_out_admin").textContent = eur(adminYear);
      el("tax_out_interest").textContent = eur(interestYear);
      el("tax_profit").textContent = eur(taxable);
      el("tax_effect").textContent = eur(taxEffect);

      const kpiBT = el("kpi_cashflow_bt");
      kpiBT.classList.toggle("green", cashflowBT_mon > 0);
      kpiBT.classList.toggle("red", cashflowBT_mon < 0);

      const kpiAT = el("kpi_liq_at");
      kpiAT.classList.toggle("green", liqAT_mon > 0);
      kpiAT.classList.toggle("red", liqAT_mon < 0);

      el("out_cf_yield").textContent = (cfYield === null) ? "—" : pct(cfYield);
      el("out_roe").textContent = (roe === null) ? "—" : pct(roe);

      const note =
        (kp===0 && area===0 && rentQmEff===0 && z===0 && t===0)
          ? "Trage Werte ein, um eine Erstabschätzung zu erhalten."
          : `Betrachtungsjahr = ${viewYear} | Mieten sind bidirektional synchronisiert (€/m² ↔ Monat ↔ Jahr).`;
      if (el("out_note")) el("out_note").textContent = note;

      if (ekEurRaw > 0 && kp > 0){
        el("ek_pct").value = nf2plain.format(ekp).replace(".", ",");
      }

      const assWert = Math.max(0, parseDeNumber(el("ass_wert_pct").value))/100;
      const assAusfall2 = Math.min(100, Math.max(0, parseDeNumber(el("ass_ausfall_pct").value)))/100;

      upsertCharts({
        kp,
        kredit,
        z,
        rate,
        mieteMonat: mieteMonat0,
        nukSum,
        verwMonat,
        assWert,
        assAusfall: assAusfall2,
        taxRate,
        afaRate,
        afaBaseBuildingAcq,
        capexTotal,
        capexCapitalized: capexCap,
        capexMode
      });
    }

    function bind(){
      ids.forEach(id => {
        const skipInputCalc = rentSensitiveIds.has(id);
        attachAutoFormat(id, { skipInputCalc });
      });

      const vy = el("view_year");
      if (vy){
        vy.addEventListener("input", () => {
          const y = Math.max(1, Math.min(20, Math.round(parseDeNumber(vy.value) || 1)));
          if (el("tax_year_label")) el("tax_year_label").textContent = String(y);
          calc();
        });
      }

      el("miete_qm")?.addEventListener("input", () => { lastRentEdited = "perqm"; syncRentFields(); calc(); });
      el("miete_monat")?.addEventListener("input", () => { lastRentEdited = "month"; syncRentFields(); calc(); });
      el("miete_jahr")?.addEventListener("input", () => { lastRentEdited = "year"; syncRentFields(); calc(); });

      el("wf")?.addEventListener("input", () => { syncRentFields(); calc(); });

      ["miete_qm","miete_monat","miete_jahr","wf"].forEach(id => {
        el(id)?.addEventListener("blur", () => {
          formatInput(id);
          syncRentFields();
          calc();
        });
      });

      document.querySelectorAll('input[name="capexMode"]').forEach(r => {
        r.addEventListener("change", () => calc());
      });

      document.querySelectorAll('input[name="nkMode"]').forEach(r => {
        r.addEventListener("change", () => calc());
      });

      document.querySelectorAll('input[name="rentInputMode"]').forEach(r => {
        r.addEventListener("change", () => {
          setRentInputMode(getRentInputMode());
          syncRentFields();
          calc();
        });
      });

      attachShiftArrowBoost(el("kaufpreis"), 1000);
      attachShiftArrowBoost(el("capex_total"), 1000);
      attachShiftArrowBoost(el("capex_rent_uplift"), 10);
      attachShiftArrowBoost(el("verw"), 10);
      attachShiftArrowBoost(el("miete_monat"), 50);
      attachShiftArrowBoost(el("miete_jahr"), 500);

      document.querySelectorAll('input[name="rentMode"]').forEach(r => {
        r.addEventListener("change", () => {
          setRentMode(document.querySelector('input[name="rentMode"]:checked')?.value || "pa");
          calc();
        });
      });

      el("resetBtn").addEventListener("click", () => {
        setRentMode("pa");
        applyDefaults({ ...defaultsZero, ...defaultsCommon });
      });

      el("leipzigDefaultsBtn").addEventListener("click", () => {
        setRentMode("pa");
        applyDefaults(defaultsLeipzig);
      });

      el("halleDefaultsBtn").addEventListener("click", () => {
        setRentMode("pa");
        applyDefaults(defaultsHalle);
      });

      el("dresdenDefaultsBtn").addEventListener("click", () => {
        setRentMode("pa");
        applyDefaults(defaultsDresden);
      });

      el("copyBtn").addEventListener("click", async () => {
        const rentMode = getRentInputMode();
        const rentModeLabel = rentMode === "month" ? "Monatsmiete" : rentMode === "year" ? "Jahresmiete" : "€/m²";

        const lines = [];
        lines.push("Cashflow-Rechner (Grundmann Consulting)");
        lines.push("");
        lines.push("Eingaben");
        lines.push(`- Kaufpreis: ${el("kaufpreis").value} €`);
        lines.push(`- Kaufnebenkosten Finanzierung: ${getNkMode()==="equity" ? "Eigenkapital" : "mitfinanziert"}`);
        lines.push(`- Capex (Investition): ${el("capex_total").value} €`);
        lines.push(`- Capex Finanzierung: ${getCapexMode()==="equity" ? "Eigenkapital" : "mitfinanziert"}`);
        lines.push(`- Miet-Boost (monatl.): ${el("capex_rent_uplift").value} €`);
        lines.push(`- Baujahr: ${el("baujahr").value}`);
        lines.push(`- Gebäudeanteil: ${el("geb_anteil_pct").value} %`);
        lines.push(`- Grenzsteuersatz: ${el("tax_pct").value} %`);
        lines.push(`- Eigenkapital (%): ${el("ek_pct").value} %`);
        lines.push(`- Eigenkapital (€): ${el("ek_eur").value} €`);
        lines.push(`- Notar & Grundbuch (%): ${el("nk_notar_pct").value} %`);
        lines.push(`- Grunderwerbsteuer (%): ${el("nk_grest_pct").value} %`);
        lines.push(`- Makler (%): ${el("nk_makler_pct").value} %`);
        lines.push(`- Zins (%): ${el("zins_pct").value} %`);
        lines.push(`- Tilgung (%): ${el("tilgung_pct").value} %`);
        lines.push(`- Wohnfläche: ${el("wf").value} m²`);
        lines.push(`- Mieteingabe (Anzeige): ${rentModeLabel}`);
        lines.push(`- Miete €/m²: ${el("miete_qm").value} €`);
        lines.push(`- Miete Monat: ${el("miete_monat").value} €`);
        lines.push(`- Miete Jahr: ${el("miete_jahr").value} €`);
        lines.push(`- Instandhaltungsrücklage €/m²: ${el("ih_qm").value} €`);
        lines.push(`- Verwaltung (Monat): ${el("verw").value} €`);
        lines.push(`- Betrachtungsjahr: ${el("view_year").value}`);

        lines.push("");
        lines.push("Ergebnisse");
        lines.push(`- Kaufnebenkosten (Summe): ${el("out_nk_sum").textContent}`);
        lines.push(`- Eigenkapital (Kauf): ${el("out_ek").textContent}`);
        lines.push(`- Zus. EK NK: ${el("out_nk_ek").textContent}`);
        lines.push(`- Zus. EK Capex: ${el("out_capex_ek").textContent}`);
        lines.push(`- EK gesamt: ${el("out_ek_total").textContent}`);
        lines.push(`- Kredit: ${el("out_kredit").textContent}`);
        lines.push(`- Rate: ${el("out_rate").textContent}`);
        lines.push(`- Miete (Betrachtungsjahr): ${el("out_miete_y").textContent}`);
        lines.push(`- Nicht umlagefähige NK: ${el("out_nuk").textContent}`);
        lines.push(`- Cashflow (vor Steuer): ${el("out_cashflow_bt").textContent}`);
        lines.push(`- Liquidität (nach Steuer): ${el("out_liq_at").textContent}`);

        const text = lines.join("\n");
        try{
          await navigator.clipboard.writeText(text);
          el("copyBtn").textContent = "Kopiert ✓";
          setTimeout(() => (el("copyBtn").textContent = "Ergebnisse kopieren"), 1200);
        }catch(e){
          alert("Kopieren nicht möglich (Browser-Einstellung).");
        }
      });

      setRentMode("pa");
      setRentInputMode("perqm");
      applyDefaults({ ...defaultsZero, ...defaultsCommon });
    }

    bind();

    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("kontakt-form");
      const success = document.getElementById("form-success");
      if (!form) return;

      form.addEventListener("submit", async function (event) {
        event.preventDefault();
        const data = new FormData(form);

        try {
          const response = await fetch(form.action, {
            method: form.method,
            body: data,
            headers: { "Accept": "application/json" }
          });

          if (response.ok) {
            form.reset();
            success.style.display = "block";
          } else {
            alert("Beim Senden ist ein Fehler aufgetreten. Bitte erneut versuchen.");
          }
        } catch (error) {
          alert("Verbindung fehlgeschlagen. Bitte später erneut versuchen.");
        }
      });
    });
  </script>

</body>
</html>
```
